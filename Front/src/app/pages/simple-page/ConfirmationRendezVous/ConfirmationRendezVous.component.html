<div class="container mt-4">
  <h2 class="mb-4 text-center">Gestion des rendez-vous</h2>

  <!-- Filtre par date + bouton jour -->
  <div class="controls mb-3">
    <input type="date" [(ngModel)]="selectedDate" (change)="applyDateFilter()">
    <button class="btn-today" (click)="showTodayRendezVous()">Rendez-vous du jour</button>
  </div>

  <div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>
  <div *ngIf="loading" class="alert alert-info">Chargement...</div>

  <!-- Formulaire d'ajout -->
  <div class="mb-3 p-3 border rounded">
    <h5>Ajouter un rendez-vous</h5>
    <div class="row g-2">
      <div class="col">
        <input type="number" class="form-control" placeholder="ID" [(ngModel)]="newRdv.id">
      </div>
      <div class="col">
        <input type="text" class="form-control" placeholder="Acte" [(ngModel)]="newRdv.idActe">
      </div>
      <div class="col">
        <input type="text" class="form-control" placeholder="Personnel" [(ngModel)]="newRdv.idPersonnel">
      </div>
      <div class="col">
        <input type="text" class="form-control" placeholder="Fauteuil" [(ngModel)]="newRdv.idFauteuil">
      </div>
    </div>
    <div class="row g-2 mt-2">
      <div class="col">
        <input type="date" class="form-control" placeholder="Date RDV" [(ngModel)]="newRdv.dateRdvConfirme">
      </div>
      <div class="col">
        <input type="time" class="form-control" placeholder="Heure RDV" [(ngModel)]="newRdv.heureRdvConfirme">
      </div>
      <div class="col">
        <input type="date" class="form-control" placeholder="Date arrivée" [(ngModel)]="newRdv.dateArriveePatient">
      </div>
      <div class="col">
        <input type="time" class="form-control" placeholder="Heure arrivée" [(ngModel)]="newRdv.heureArriveePatient">
      </div>
    </div>
    <div class="row g-2 mt-2">
      <div class="col">
        <input type="number" class="form-control" placeholder="Durée" [(ngModel)]="newRdv.rdvDuree">
      </div>
      <div class="col">
        <input type="time" class="form-control" placeholder="Salle attente" [(ngModel)]="newRdv.heureSalleAttente">
      </div>
      <div class="col">
        <input type="time" class="form-control" placeholder="Heure sortie" [(ngModel)]="newRdv.heureSortie">
      </div>
      <div class="col">
        <button class="btn btn-success" (click)="addRendezVous()">Ajouter</button>
      </div>
    </div>
  </div>

  <!-- Tableau scrollable -->
  <div class="table-container">
    <table class="table table-bordered table-striped" *ngIf="filteredRendezVousList.length > 0">
      <thead>
        <tr>
          <th>ID Dim</th>
          <th>ID</th>
          <th>Acte</th>
          <th>Personnel</th>
          <th>Fauteuil</th>
          <th>Date RDV</th>
          <th>Heure RDV</th>
          <th>Date arrivée</th>
          <th>Heure arrivée</th>
          <th>Durée</th>
          <th>Salle attente</th>
          <th>Heure sortie</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let rdv of filteredRendezVousList">
          <td>{{ rdv.idDimConfirmationRendezVous }}</td>
          <td>{{ rdv.id }}</td>
          <td *ngIf="editRendezVousId !== rdv.idDimConfirmationRendezVous">{{ rdv.idActe }}</td>
          <td *ngIf="editRendezVousId === rdv.idDimConfirmationRendezVous">
            <input [(ngModel)]="editedRendezVous.idActe" class="form-control"/>
          </td>
          <td *ngIf="editRendezVousId !== rdv.idDimConfirmationRendezVous">{{ rdv.idPersonnel }}</td>
          <td *ngIf="editRendezVousId === rdv.idDimConfirmationRendezVous">
            <input [(ngModel)]="editedRendezVous.idPersonnel" class="form-control"/>
          </td>
          <td *ngIf="editRendezVousId !== rdv.idDimConfirmationRendezVous">{{ rdv.idFauteuil }}</td>
          <td *ngIf="editRendezVousId === rdv.idDimConfirmationRendezVous">
            <input [(ngModel)]="editedRendezVous.idFauteuil" class="form-control"/>
          </td>
          <td *ngIf="editRendezVousId !== rdv.idDimConfirmationRendezVous">{{ rdv.dateRdvConfirme }}</td>
          <td *ngIf="editRendezVousId === rdv.idDimConfirmationRendezVous">
            <input [(ngModel)]="editedRendezVous.dateRdvConfirme" type="date" class="form-control"/>
          </td>
          <td *ngIf="editRendezVousId !== rdv.idDimConfirmationRendezVous">{{ rdv.heureRdvConfirme }}</td>
          <td *ngIf="editRendezVousId === rdv.idDimConfirmationRendezVous">
            <input [(ngModel)]="editedRendezVous.heureRdvConfirme" type="time" class="form-control"/>
          </td>
          <td *ngIf="editRendezVousId !== rdv.idDimConfirmationRendezVous">{{ rdv.dateArriveePatient }}</td>
          <td *ngIf="editRendezVousId === rdv.idDimConfirmationRendezVous">
            <input [(ngModel)]="editedRendezVous.dateArriveePatient" type="date" class="form-control"/>
          </td>
          <td *ngIf="editRendezVousId !== rdv.idDimConfirmationRendezVous">{{ rdv.heureArriveePatient }}</td>
          <td *ngIf="editRendezVousId === rdv.idDimConfirmationRendezVous">
            <input [(ngModel)]="editedRendezVous.heureArriveePatient" type="time" class="form-control"/>
          </td>
          <td *ngIf="editRendezVousId !== rdv.idDimConfirmationRendezVous">{{ rdv.rdvDuree }}</td>
          <td *ngIf="editRendezVousId === rdv.idDimConfirmationRendezVous">
            <input [(ngModel)]="editedRendezVous.rdvDuree" type="number" class="form-control"/>
          </td>
          <td *ngIf="editRendezVousId !== rdv.idDimConfirmationRendezVous">{{ rdv.heureSalleAttente }}</td>
          <td *ngIf="editRendezVousId === rdv.idDimConfirmationRendezVous">
            <input [(ngModel)]="editedRendezVous.heureSalleAttente" type="time" class="form-control"/>
          </td>
          <td *ngIf="editRendezVousId !== rdv.idDimConfirmationRendezVous">{{ rdv.heureSortie }}</td>
          <td *ngIf="editRendezVousId === rdv.idDimConfirmationRendezVous">
            <input [(ngModel)]="editedRendezVous.heureSortie" type="time" class="form-control"/>
          </td>
          <td>
            <button *ngIf="editRendezVousId !== rdv.idDimConfirmationRendezVous" class="btn btn-primary btn-sm" (click)="editRendezVous(rdv)">Modifier</button>
            <button *ngIf="editRendezVousId === rdv.idDimConfirmationRendezVous" class="btn btn-success btn-sm" (click)="saveRendezVous()">Sauvegarder</button>
            <button *ngIf="editRendezVousId === rdv.idDimConfirmationRendezVous" class="btn btn-secondary btn-sm" (click)="cancelEdit()">Annuler</button>
            <button class="btn btn-danger btn-sm" (click)="confirmDelete(rdv.idDimConfirmationRendezVous)">Supprimer</button>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="filteredRendezVousList.length === 0 && !loading" class="text-center p-2">
      Aucun rendez-vous à afficher.
    </div>
  </div>

  <!-- Popup suppression -->
  <div *ngIf="showDeleteConfirm" class="modal-backdrop">
    <div class="modal-dialog">
      <div class="modal-content p-3">
        <h5>Êtes-vous sûr de supprimer ce rendez-vous ?</h5>
        <div class="mt-3 d-flex justify-content-end">
          <button class="btn btn-danger me-2" (click)="delete(selectedId)">Oui</button>
          <button class="btn btn-secondary" (click)="cancelDelete()">Annuler</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Popup succès suppression -->
  <div *ngIf="deleteSuccess" class="popup-success">
    ✅ Rendez-vous supprimé
  </div>

  <!-- Popup succès ajout -->
  <div *ngIf="addSuccess" class="popup-success">
    ✅ Rendez-vous ajouté
  </div>

  <!-- Popup succès sauvegarde -->
  <div *ngIf="saveSuccess" class="popup-success">
    ✅ Données sauvegardées
  </div>
</div>
