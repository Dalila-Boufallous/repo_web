<div class="row">
  <div class="container mt-4">
    <h2 class="mb-4 text-center">Gestion des rendez-vous</h2>
    
    <div class="row g-3">
      <!-- Carte 1 -->
      <div class="col-md-6 col-xl-4">
        <div class="mini-card">
          <div class="icon blue">
            <i class="icofont icofont-calendar"></i>
          </div>
          <div class="content">
            <span class="title">Rendez-vous du jour</span>
            <h4>49</h4>
            <small class="subtitle">&nbsp;</small>
          </div>
        </div>
      </div>

      <!-- Carte 2 -->
      <div class="col-md-6 col-xl-4">
        <div class="mini-card">
          <div class="icon pink">
            <i class="icofont icofont-close-squared-alt"></i>
          </div>
          <div class="content">
            <span class="title">Patients sans rendez-vous</span>
            <h4>101</h4>
            <small class="subtitle">Dernier mois</small>
          </div>
        </div>
      </div>
      <!-- Carte 3 transformée en bouton -->
<div class="col-md-6 col-xl-4">
  <div class="mini-card clickable-card" (click)="showWeekRendezVous()">
    <div class="icon green">
      <i class="icofont icofont-ebook"></i>
    </div>
    <div class="content">
      <span class="title">Rendez-vous de la semaine</span>
      <h4>{{ weeklyRendezVousCount }}</h4>
      <small class="subtitle">&nbsp;</small>
    </div>
  </div>
</div>

    </div> <!-- nahyha si tu veux thot formulaire hedhe l calendrier -->

    <!-- Mini-calendrier -->
    <div class="mini-calendar-wrapper mb-3">
      <div class="mini-calendar">
        <div class="mc-header">
          <select class="mc-select" [(ngModel)]="calMonth" (change)="buildCalendar()">
            <option *ngFor="let m of monthNames; let i=index" [ngValue]="i">{{ m }}</option>
          </select>
          <select class="mc-select" [(ngModel)]="calYear" (change)="buildCalendar()">
            <option *ngFor="let y of yearRange" [value]="y">{{ y }}</option>
          </select>
        </div>

        <div class="mc-weekdays">
          <div *ngFor="let wd of weekdayNames" class="mc-wd">{{ wd }}</div>
        </div>

        <div class="mc-weeks">
          <div class="mc-week" *ngFor="let week of calendarWeeks">
            <button
              class="mc-day"
              *ngFor="let day of week"
              [class.empty]="!day"
              [class.today]="day && isToday(day)"
              [class.selected]="day && selectedDate === formatDate(day)"
              (click)="selectCalendarDate(day)"
              [disabled]="!day"
            >
              {{ day ? day.getDate() : '' }}
            </button>
          </div>
        </div>

        <div class="mc-footer">
          <button class="btn btn-sm mc-today" (click)="showTodayRendezVous()">Rendez-vous du jour</button>
        </div>
      </div>
    </div>

    <div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>
    <div *ngIf="loading" class="alert alert-info">Chargement...</div>

    <!-- Formulaire d'ajout -->
    <div class="mb-3 p-3 border rounded">
      <h5>Ajouter un rendez-vous</h5>

      <div class="row g-2">
        <div class="col">
          <input type="number" class="form-control" placeholder="ID" [(ngModel)]="newRdv.id">
          <small class="form-text text-muted">ID du rendez-vous</small>
        </div>
        <div class="col">
          <input type="text" class="form-control" placeholder="Acte" [(ngModel)]="newRdv.idActe">
          <small class="form-text text-muted">Acte médical</small>
        </div>
        <div class="col">
          <input type="text" class="form-control" placeholder="Personnel" [(ngModel)]="newRdv.idPersonnel">
          <small class="form-text text-muted">Personnel assigné</small>
        </div>
        <div class="col">
          <input type="text" class="form-control" placeholder="Fauteuil" [(ngModel)]="newRdv.idFauteuil">
          <small class="form-text text-muted">Numéro de fauteuil</small>
        </div>
      </div>

      <div class="row g-2 mt-2">
        <div class="col">
          <input type="date" class="form-control" placeholder="Date RDV" [(ngModel)]="newRdv.dateRdvConfirme">
          <small class="form-text text-muted">Date du rendez-vous confirmé</small>
        </div>
        <div class="col">
          <input type="time" class="form-control" placeholder="Heure RDV" [(ngModel)]="newRdv.heureRdvConfirme">
          <small class="form-text text-muted">Heure du rendez-vous</small>
        </div>
        <div class="col">
          <input type="date" class="form-control" placeholder="Date arrivée" [(ngModel)]="newRdv.dateArriveePatient">
          <small class="form-text text-muted">Date d’arrivée du patient</small>
        </div>
        <div class="col">
          <input type="time" class="form-control" placeholder="Heure arrivée" [(ngModel)]="newRdv.heureArriveePatient">
          <small class="form-text text-muted">Heure d’arrivée</small>
        </div>
      </div>

      <div class="row g-2 mt-2">
        <div class="col">
          <input type="number" class="form-control" placeholder="Durée" [(ngModel)]="newRdv.rdvDuree">
          <small class="form-text text-muted">Durée du rendez-vous (minutes)</small>
        </div>
        <div class="col">
          <input type="time" class="form-control" placeholder="Salle attente" [(ngModel)]="newRdv.heureSalleAttente">
          <small class="form-text text-muted">Heure entrée salle d’attente</small>
        </div>
        <div class="col">
          <input type="time" class="form-control" placeholder="Heure sortie" [(ngModel)]="newRdv.heureSortie">
          <small class="form-text text-muted">Heure de sortie du rendez-vous</small>
        </div>
        <div class="col">
          <button class="btn btn-success mt-4 w-100" (click)="addRendezVous()">Ajouter</button>
        </div>
      </div>
    </div>

    <!-- Tableau scrollable -->
    <div class="table-container">
      <table class="table table-bordered table-striped" *ngIf="filteredRendezVousList.length > 0">
        <thead>
          <tr>
            <th>ID Dim</th>
            <th>ID</th>
            <th>Acte</th>
            <th>Personnel</th>
            <th>Fauteuil</th>
            <th>Date RDV</th>
            <th>Heure RDV</th>
            <th>Date arrivée</th>
            <th>Heure arrivée</th>
            <th>Durée</th>
            <th>Salle attente</th>
            <th>Heure sortie</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let rdv of filteredRendezVousList">
            <td>{{ rdv.idDimConfirmationRendezVous }}</td>
            <td>{{ rdv.id }}</td>
            <td *ngIf="editRendezVousId !== rdv.idDimConfirmationRendezVous">{{ rdv.idActe }}</td>
            <td *ngIf="editRendezVousId === rdv.idDimConfirmationRendezVous">
              <input [(ngModel)]="editedRendezVous.idActe" class="form-control"/>
            </td>
            <td *ngIf="editRendezVousId !== rdv.idDimConfirmationRendezVous">{{ rdv.idPersonnel }}</td>
            <td *ngIf="editRendezVousId === rdv.idDimConfirmationRendezVous">
              <input [(ngModel)]="editedRendezVous.idPersonnel" class="form-control"/>
            </td>
            <td *ngIf="editRendezVousId !== rdv.idDimConfirmationRendezVous">{{ rdv.idFauteuil }}</td>
            <td *ngIf="editRendezVousId === rdv.idDimConfirmationRendezVous">
              <input [(ngModel)]="editedRendezVous.idFauteuil" class="form-control"/>
            </td>
            <td *ngIf="editRendezVousId !== rdv.idDimConfirmationRendezVous">{{ rdv.dateRdvConfirme }}</td>
            <td *ngIf="editRendezVousId === rdv.idDimConfirmationRendezVous">
              <input [(ngModel)]="editedRendezVous.dateRdvConfirme" type="date" class="form-control"/>
            </td>
            <td *ngIf="editRendezVousId !== rdv.idDimConfirmationRendezVous">{{ rdv.heureRdvConfirme }}</td>
            <td *ngIf="editRendezVousId === rdv.idDimConfirmationRendezVous">
              <input [(ngModel)]="editedRendezVous.heureRdvConfirme" type="time" class="form-control"/>
            </td>
            <td *ngIf="editRendezVousId !== rdv.idDimConfirmationRendezVous">{{ rdv.dateArriveePatient }}</td>
            <td *ngIf="editRendezVousId === rdv.idDimConfirmationRendezVous">
              <input [(ngModel)]="editedRendezVous.dateArriveePatient" type="date" class="form-control"/>
            </td>
            <td *ngIf="editRendezVousId !== rdv.idDimConfirmationRendezVous">{{ rdv.heureArriveePatient }}</td>
            <td *ngIf="editRendezVousId === rdv.idDimConfirmationRendezVous">
              <input [(ngModel)]="editedRendezVous.heureArriveePatient" type="time" class="form-control"/>
            </td>
            <td *ngIf="editRendezVousId !== rdv.idDimConfirmationRendezVous">{{ rdv.rdvDuree }}</td>
            <td *ngIf="editRendezVousId === rdv.idDimConfirmationRendezVous">
              <input [(ngModel)]="editedRendezVous.rdvDuree" type="number" class="form-control"/>
            </td>
            <td *ngIf="editRendezVousId !== rdv.idDimConfirmationRendezVous">{{ rdv.heureSalleAttente }}</td>
            <td *ngIf="editRendezVousId === rdv.idDimConfirmationRendezVous">
              <input [(ngModel)]="editedRendezVous.heureSalleAttente" type="time" class="form-control"/>
            </td>
            <td *ngIf="editRendezVousId !== rdv.idDimConfirmationRendezVous">{{ rdv.heureSortie }}</td>
            <td *ngIf="editRendezVousId === rdv.idDimConfirmationRendezVous">
              <input [(ngModel)]="editedRendezVous.heureSortie" type="time" class="form-control"/>
            </td>
            <td>
              <button *ngIf="editRendezVousId !== rdv.idDimConfirmationRendezVous" class="btn btn-primary btn-sm" (click)="editRendezVous(rdv)">Modifier</button>
              <button *ngIf="editRendezVousId === rdv.idDimConfirmationRendezVous" class="btn btn-success btn-sm" (click)="saveRendezVous()">Sauvegarder</button>
              <button *ngIf="editRendezVousId === rdv.idDimConfirmationRendezVous" class="btn btn-secondary btn-sm" (click)="cancelEdit()">Annuler</button>
              <button class="btn btn-danger btn-sm" (click)="confirmDelete(rdv.idDimConfirmationRendezVous)">Supprimer</button>
            </td>
          </tr>
        </tbody>
      </table>

      <div *ngIf="filteredRendezVousList.length === 0 && !loading" class="text-center p-2">
        Aucun rendez-vous à afficher.
      </div>
    </div>

    <!-- Popup suppression -->
    <div *ngIf="showDeleteConfirm" class="modal-backdrop">
      <div class="modal-dialog">
        <div class="modal-content p-3">
          <h5>Êtes-vous sûr de supprimer ce rendez-vous ?</h5>
          <div class="mt-3 d-flex justify-content-end">
            <button class="btn btn-danger me-2" (click)="delete(selectedId)">Oui</button>
            <button class="btn btn-secondary" (click)="cancelDelete()">Annuler</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Popup succès suppression -->
    <div *ngIf="deleteSuccess" class="popup-success">
      ✅ Rendez-vous supprimé
    </div>

    <!-- Popup succès ajout -->
    <div *ngIf="addSuccess" class="popup-success">
      ✅ Rendez-vous ajouté
    </div>

    <!-- Popup succès sauvegarde -->
    <div *ngIf="saveSuccess" class="popup-success">
      ✅ Données sauvegardées
    </div>
  </div>
</div>
